---
layout: post
title:  "支持中文不？"
date:   2013-05-09 13:39:20
categories: jekyll update
---

新建rails工程demo

	rails new demo -TO
我这里不要rails的test和orm , 我选择rspec，mongoid
进入项目根目录

	cd demo
打开Gemfile文件，加入一下代码:
{% highlight ruby %}

	gem "devise"
	gem "mongoid"
	gem "bson_ext"
	gem "rspec"
	gem "rspec-rails"
{% endhighlight %}
配置mongoid：

	rails g mongoid:config
新建名为home的controller，并添加index方法

	rails g controller home index
配置devise

	rails g devise:install
然后会有如下提示：

	  create  config/initializers/devise.rb
      create  config/locales/devise.en.yml
	===============================================================================

	Some setup you must do manually if you haven&#039;t yet:

  	1. Ensure you have defined default url options in your environments files. Here
       is an example of default_url_options appropriate for a development environment
       in config/environments/development.rb:

       config.action_mailer.default_url_options = { :host =&gt; &#039;localhost:3000&#039; }

       In production, :host should be set to the actual host of your application.

  	2. Ensure you have defined root_url to *something* in your config/routes.rb.
       For example:

       root :to =&gt; &quot;home#index&quot;

  	3. Ensure you have flash messages in app/views/layouts/application.html.erb.
       For example:

	4. If you are deploying Rails 3.1 on Heroku, you may want to set:            
       config.assets.initialize_on_precompile = false On config/application.rb forcing      
       your application to not access the DB or load models when precompiling your assets.
	===============================================================================
上面给出了安装步骤，分为4步，需要一步一步安装
在views/home/index.erb.html中加入以下代码：

	<% if user_signed_in? -%> 
    <!-- Provided by devise -->
    <div style="float:right">
      <%= current_user.email %> |
      <%= link_to '用户信息', edit_user_registration_path %> |
      <%= link_to '退出登录', destroy_user_session_path, :method => :delete %> |
    </div>
    <% end -%>
    <% unless user_signed_in? -%>
    <div style="float:right">
      <%= link_to '注册', new_user_registration_path %> |
      <%= link_to '登录', new_user_session_path %>
    </div> 
    <% end -%>
新建model

	rails g devise user
在Home控制器home_controller.rb中加入以下代码：

	before_filter :authenticate_user!
基本完成配置，删除根目录下的默认首页/devise/public/index.html，开启rails服务器和mongodb数据库

	sudo mongod -dbpath=/var/lib/mongodb &
	rails s
在浏览器中运行[localhost:3000](http://localhost:3000)
你就可以看见登录页面，因为你在访问home/index时没有登录，所以提示你登录
还可以注册，修改账户，退出，删除账户等等操作…  

---
[devise on github](https://github.com/plataformatec/devise)
